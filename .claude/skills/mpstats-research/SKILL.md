---
name: mpstats-research
description: "Исследование рынка через MPStats API: анализ нескольких категорий на Ozon, Wildberries, Яндекс Маркет. Выручка, тренды, топ-товары, бренды, продавцы, концентрация."
argument-hint: "[название ниши/рынка для исследования]"
---

# MPStats Market Research

Исследование рынка товаров по категориям на маркетплейсах через MPStats API.

## Когда использовать

- Пользователь просит «исследование рынка», «анализ ниши», «обзор категории»
- Нужно сравнить несколько категорий на нескольких маркетплейсах
- Нужен отчёт с выручкой, трендами, топ-товарами, брендами, продавцами

## Процесс исследования (пошагово)

### Шаг 1. Уточни параметры

Задай пользователю вопросы:
1. **Маркетплейсы:** все три (WB + Ozon + YM) или конкретные?
2. **Категории:** какие товары? (конкретные категории или тема)
3. **Глубина:** обзор или детальный анализ?
4. **Конкуренты:** есть ли конкретные бренды/продавцы для отслеживания?

### Шаг 2. Проверь API

```bash
uv run --with httpx,python-dotenv PRJ_ANALYTICS/mpstats/check_limit.py
```

Убедись что лимитов достаточно. Каждая категория = ~1 API-вызов (тарифицируется POST `get/category`, GET-запросы бесплатны).

### Шаг 3. Найди категории

**Вариант A — есть готовый скрипт:** Если для этой ниши уже есть скрипт `research_{тема}.py`, используй его.

**Вариант B — новая ниша:** Создай скрипт по образцу `research_sleep.py`:

1. Получи дерево категорий:
```bash
# В Python-консоли или через скрипт
client.get_categories_tree("wb")  # или "oz"
```

2. Найди релевантные категории вручную (автопоиск по ключевым словам даёт слишком много шума из-за плоской структуры дерева WB).

3. Запиши точные пути в `SLEEP_CATEGORIES` (или аналогичный dict).

**Важно:** Автоматический поиск по ключевым словам в дереве категорий MPStats ненадёжен:
- WB: дерево содержит ~282 000 записей, многие дублируются
- Короткие ключевые слова (3-4 буквы) матчат части нерелевантных слов
- Лучше найти корневой раздел (напр. «Дом/Спальня/Постельные принадлежности/») и выбрать подкатегории вручную

### Шаг 4. Запусти анализ

```bash
# Полный анализ с Excel-экспортом
uv run --with httpx,python-dotenv,openpyxl PRJ_ANALYTICS/mpstats/research_sleep.py

# Только WB
uv run --with httpx,python-dotenv,openpyxl PRJ_ANALYTICS/mpstats/research_sleep.py --platforms wb

# Только показать категории (без запросов)
uv run --with httpx,python-dotenv PRJ_ANALYTICS/mpstats/research_sleep.py --discover

# Другой период
uv run --with httpx,python-dotenv,openpyxl PRJ_ANALYTICS/mpstats/research_sleep.py --days 60
```

### Шаг 5. Документируй результат

1. **Отчёт:** создай `PRJ_ANALYTICS/mpstats/reports/{тема}_{YYYY-MM-DD}.md`
2. **Структура отчёта:**
   - Сводная таблица по категориям (выручка, продажи, ср. чек, тренд, концентрация)
   - Ключевые выводы (лидеры, тренды, концентрация, ценовые сегменты)
   - Возможности для входа
   - Риски
   - Методология

### Шаг 6. Интерпретируй для пользователя

Покажи:
- Топ-категории по выручке
- Кто лидеры (бренды и продавцы)
- Где растёт / падает
- Где низкая концентрация (возможность входа)
- Ценовые сегменты

## Существующие исследования

| Ниша | Скрипт | Отчёт | Дата |
|---|---|---|---|
| Товары для сна | `research_sleep.py` | `reports/sleep_2026-02-20.md` | 2026-02-20 |

## Создание нового скрипта исследования

Используй `research_sleep.py` как шаблон. Что нужно изменить:

1. **`SLEEP_CATEGORIES`** → переименуй в `{ТЕМА}_CATEGORIES` и заполни путями
2. **Название** в заголовках и print-ах
3. **Имя файла Excel** по умолчанию

Структура скрипта:
```
research_{тема}.py
├── SLEEP_CATEGORIES dict → категории для каждого МП
├── analyze_category()    → анализ одной категории (4 API-вызова)
├── print_report()        → текстовый отчёт в консоль
├── export_xlsx()         → Excel с 4 листами (Сводка, Товары, Бренды, Продавцы)
└── main()                → CLI с argparse (--platforms, --days, --xlsx, --discover)
```

## Метрики, которые собираем

| Метрика | Эндпоинт | Описание |
|---|---|---|
| Выручка, продажи, тренд | `get/category/by_date` | Дневные данные за период |
| Топ товары | `POST get/category` | Сортировка по revenue, топ-30 |
| Топ продавцы | `get/category/sellers` | Все продавцы категории |
| Топ бренды | `get/category/brands` | Все бренды категории |
| Концентрация | расчётная | Доля топ-5 в общей выручке |
| WoW тренд | расчётная | Ср. дневная выручка последних 7 дн. vs предыдущих 7 дн. |

## Ключевые файлы

- `PRJ_ANALYTICS/mpstats/client.py` — HTTP-клиент MPStats API
- `PRJ_ANALYTICS/mpstats/models.py` — модели данных
- `PRJ_ANALYTICS/mpstats/research_sleep.py` — шаблон исследования
- `PRJ_ANALYTICS/mpstats/reports/` — папка отчётов
- `PRJ_ANALYTICS/mpstats/PLAN.md` — справка по API-эндпоинтам

## Ограничения MPStats API

- **Яндекс Маркет:** категории возвращают 500 (на 2026-02-20), недоступен
- **Продавцы/бренды:** максимум 200 записей на запрос
- **Тариф:** GET-запросы (by_date, sellers, brands) не тарифицируются, POST (get/category) — 1 вызов
- **Rate limit:** при 429 клиент автоматически ждёт Retry-After
