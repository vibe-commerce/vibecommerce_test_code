---
name: excel-worker
description: "Работа с Excel-файлами (.xlsx, .csv): чтение, анализ, модификация, создание. Юнит-экономика для маркетплейсов (Wildberries, Ozon) и собственных интернет-магазинов (DTC). Триггерить при: .xlsx, Excel, таблица, выгрузка, отчёт, модель, юнит-экономика, маржинальность, P&L, себестоимость, комиссия, СПП, соинвест, COGS, маржа, ROI, ДРР."
---

# Excel Worker

## Правила openpyxl (только критические)

- Существующий файл → `load_workbook()`, НИКОГДА `Workbook()` (иначе данные потеряны)
- `data_only=True` → только чтение, НИКОГДА сохранять (формулы исчезнут)
- Формулы Excel (`=SUM(...)`) вместо хардкода Python — файл должен быть живым
- Сохранять с `_vX.Y.xlsx`, не перезаписывать оригинал
- Детальные паттерны openpyxl — см. [references/openpyxl-patterns.md](references/openpyxl-patterns.md)

## Юнит-экономика: Wildberries

### Формула маржинальности 1 единицы

```
Выручка селлера = Цена для покупателя × (1 − СПП%)

Чистая прибыль на единицу =
  Выручка селлера
  − Себестоимость (COGS)
  − Комиссия WB (% от выручки селлера, зависит от категории)
  − Логистика (FBO/FBS, зависит от габаритов и схемы)
  − Хранение (за единицу/день на складе WB)
  − Налог (УСН 6% от выручки или 15% от прибыли)
  − Расходы на рекламу (внутренняя + внешняя)
  − Упаковка и подготовка
  − Возвраты и брак (% от заказов × стоимость обратной логистики)

Маржинальность % = Чистая прибыль / Цена для покупателя × 100
```

### СПП (Скидка постоянного покупателя)

Механика: WB даёт покупателю скидку, а компенсация ложится на селлера через повышенную комиссию. Но СПП может работать и в обратную сторону — при высоком СПП WB **доплачивает** селлеру (компенсация превышает комиссию). По сути СПП — это скользящая шкала, где баланс между скидкой покупателю и нагрузкой на селлера меняется динамически.

Влияние на юнит-экономику:
- СПП > 0 → покупатель видит цену ниже, выручка селлера уменьшается
- СПП может быть настолько большим, что WB компенсирует больше, чем берёт комиссии → **нетто-доплата** селлеру
- При расчёте всегда учитывать текущий % СПП (меняется динамически)

### Ключевые метрики WB

| Метрика | Формула |
|---------|---------|
| Выручка селлера | Цена покупателя × (1 − СПП%) |
| Комиссия WB | Выручка селлера × Ставка комиссии% |
| Маржа на единицу | Выручка − COGS − Комиссия − Логистика − Хранение − Налог − Реклама |
| ROI на товар | Чистая прибыль / (COGS + Логистика до склада) × 100 |
| ДРР (Доля рекл. расходов) | Расходы на рекламу / Выручка × 100 |
| Оборачиваемость | Продажи за период / Средний остаток на складе |
| Процент выкупа | Выкупленные заказы / Все заказы × 100 |

## Юнит-экономика: Ozon

### Формула маржинальности 1 единицы

```
Цена продажи = Базовая цена − Скидка продавца

Эффективная комиссия = Базовая комиссия% − Соинвест от Ozon

Чистая прибыль на единицу =
  Цена продажи
  − Себестоимость (COGS)
  − Комиссия Ozon (эффективная ставка после соинвеста)
  − Логистика (last mile + processing, зависит от схемы FBO/FBS/rFBS)
  − Эквайринг (если применимо)
  − Налог
  − Реклама (трафареты, продвижение в поиске, акции)
  − Упаковка
  − Возвраты (% × стоимость обратной логистики)
```

### Соинвест (со-инвестирование скидки)

Механика: продавец даёт скидку, а Ozon **уменьшает свою комиссию** пропорционально скидке продавца. Чем больше скидка продавца → тем меньше комиссия Ozon. Ozon фактически разделяет с продавцом расходы на стимулирование покупателя.

Влияние на юнит-экономику:
- Скидка продавца 10% → комиссия Ozon может снизиться, например, с 15% до 10%
- Нетто-эффект: продавец теряет на цене, но выигрывает на комиссии
- Нужно считать баланс: потеря от скидки vs экономия на комиссии vs рост оборота

### Ключевые метрики Ozon

| Метрика | Формула |
|---------|---------|
| Цена продажи | Базовая цена × (1 − Скидка продавца%) |
| Эффективная комиссия | Базовая комиссия% − Соинвест% |
| Комиссия Ozon | Цена продажи × Эффективная комиссия% |
| Маржа на единицу | Цена продажи − COGS − Комиссия − Логистика − Налог − Реклама |
| ДРР | Расходы на рекламу / Выручка × 100 |
| Индекс цены Ozon | Цена товара / Мин. цена на рынке (влияет на видимость) |

## Юнит-экономика: DTC (собственный интернет-магазин)

### Формула маржинальности 1 единицы

```
Чистая прибыль на единицу =
  Цена продажи
  − Себестоимость (COGS)
  − Эквайринг (1.5–3.5%)
  − Доставка (курьерка / ПВЗ / Почта)
  − Налог
  − Стоимость привлечения клиента (CAC)
  − Упаковка
  − Возвраты (% × себестоимость обратной обработки)
```

### Ключевые метрики DTC

| Метрика | Формула |
|---------|---------|
| CAC | Расходы на маркетинг / Количество новых клиентов |
| LTV | Средний чек × Частота покупок × Срок жизни клиента |
| LTV/CAC | Должно быть > 3 для устойчивости |
| AOV (Средний чек) | Выручка / Количество заказов |
| CR (Конверсия) | Заказы / Визиты × 100 |
| CPC | Расходы на рекламу / Клики |
| ROAS | Выручка от рекламы / Расходы на рекламу |
| ДРР | Расходы на рекламу / Выручка × 100 |
| Retention rate | Повторные покупатели / Все покупатели × 100 |

## Глоссарий

| Термин | Расшифровка |
|--------|-------------|
| СПП | Скидка постоянного покупателя (WB). Компенсация/комиссия селлера, может быть отрицательной (WB доплачивает) |
| Соинвест | Со-инвестирование скидки (Ozon). Ozon снижает комиссию в ответ на скидку продавца |
| COGS | Cost of Goods Sold — себестоимость товара |
| FBO | Fulfillment by Operator — товар на складе маркетплейса |
| FBS | Fulfillment by Seller — товар на складе продавца, доставка через МП |
| rFBS | Real FBS (Ozon) — продавец сам доставляет |
| DBS | Delivery by Seller — полностью своя доставка |
| ДРР | Доля рекламных расходов = Реклама / Выручка × 100 |
| CAC | Customer Acquisition Cost — стоимость привлечения клиента |
| LTV | Lifetime Value — пожизненная ценность клиента |
| AOV | Average Order Value — средний чек |
| ROAS | Return on Ad Spend — возврат на рекламные расходы |
| ROI | Return on Investment — возврат на инвестиции |
| Оборачиваемость | Скорость продажи запаса (дни или разы за период) |
| Процент выкупа | Доля выкупленных заказов от всех заказанных (WB) |
| Индекс цены | Отношение цены к минимальной на рынке (Ozon) |
| УСН | Упрощённая система налогообложения (6% доход / 15% доход−расход) |
